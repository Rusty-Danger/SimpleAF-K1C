# K1C
# Printer_size: 220x220x250
# Version: v2.0.5
# CreateDate: 2023/09/05
# Nozzle_mcu: chip: GD32F303CBT6
#             version: CR-K1-MAX-NOZZLE-V1.2.0
# Leveling_mcu: chip: GD32E230F8P6
#             version: CR-K1-MAX-LEVELING-V1.1.0
# mcu: chip: GD32F303RET6
#      version: CR4CU220812S12

[include sensorless.cfg]
[include internal_macros.cfg]

[include useful_macros.cfg]

[include belts_calibration.cfg]

[include start_end.cfg]

[include Line_Purge.cfg]

[include Smart_Park.cfg]

[include fan_control.cfg]

[include client.cfg]

[include quickstart.cfg]

[include btteddy.cfg]

[include btteddy_macro.cfg]

[mcu]
serial: /dev/ttyS7
baud: 230400
restart_method: command

[mcu nozzle_mcu]
serial: /dev/ttyS1
baud: 230400
restart_method: command

[verify_heater extruder]
[verify_heater heater_bed]
check_gain_time: 120
heating_gain: 1.0
hysteresis: 10

[gcode_arcs]
resolution: 1.0

[stepper_x]
step_pin: PC2
dir_pin: !PB9
enable_pin: !PC3
microsteps: 32
rotation_distance: 40
endstop_pin: tmc2209_stepper_x:virtual_endstop
position_endstop: 229
position_min: -5
position_max: 229
homing_speed: 30
homing_retract_dist:0

[tmc2209 stepper_x]
uart_pin:PA9
interpolate: True
run_current:1.5
sense_resistor: 0.100
stealthchop_threshold: 0
uart_address:3
diag_pin: ^PB12
# driver_IHOLDDELAY: 8
# driver_TPOWERDOWN: 20
# driver_TBL: 1
# driver_TOFF: 1
# driver_HEND: 0
# driver_HSTRT: 7
driver_SGTHRS: 75
# hold_current:1.0

[stepper_y]
step_pin: PB8
dir_pin: !PB7
enable_pin: !PC3
microsteps: 32
rotation_distance: 40
endstop_pin: tmc2209_stepper_y:virtual_endstop
position_endstop: -0.5
position_min: -0.5
position_max: 226
homing_speed: 30
homing_retract_dist:0

[tmc2209 stepper_y]
uart_pin:PA10
interpolate: True
run_current:1.5
sense_resistor: 0.100
stealthchop_threshold: 0
uart_address:3
diag_pin: ^PB13
# driver_IHOLDDELAY: 8
# driver_TPOWERDOWN: 20
# driver_TBL: 1
# driver_TOFF: 1
# driver_HEND: 0
# driver_HSTRT: 7
driver_SGTHRS: 75
# hold_current:1.0

[stepper_z]
step_pin: PB6
dir_pin: !PB5
enable_pin: !PC3
microsteps: 16
rotation_distance:8
gear_ratio: 64:20
endstop_pin: probe:z_virtual_endstop
position_max: 252
position_min: -5
# position_endstop: 0

[tmc2209 stepper_z]
uart_pin: PA11
uart_address: 3
run_current: 0.8
diag_pin: ^PB14
stealthchop_threshold: 0
sense_resistor: 0.100
# driver_IHOLDDELAY: 8
# driver_TPOWERDOWN: 20
# driver_TBL: 1
# driver_TOFF: 1
# driver_HEND: 2
# driver_HSTRT: 2
driver_SGTHRS: 0

[extruder]
max_extrude_only_distance: 1000.0
max_extrude_cross_section: 80
step_pin: nozzle_mcu:PB1
dir_pin: nozzle_mcu:PB0
enable_pin: !nozzle_mcu:PB2
microsteps: 16
rotation_distance: 6.9
nozzle_diameter: 0.400
filament_diameter: 1.750
heater_pin: nozzle_mcu:PB7
sensor_type: EPCOS 100K B57560G104F
sensor_pin: nozzle_mcu:PA0
pressure_advance: 0.04
pressure_advance_smooth_time: 0.040
min_temp: 0
max_temp: 320
#control: pid
#pid_kp: 27.803
#pid_ki: 2.990
#pid_kd: 64.642

[tmc2209 extruder]
uart_pin: nozzle_mcu:PB11
tx_pin: nozzle_mcu:PB10

uart_address: 3
run_current: 0.55
sense_resistor: 0.150
stealthchop_threshold: 0
# driver_IHOLDDELAY: 8
# driver_TPOWERDOWN: 20
# driver_TBL: 2
# driver_TOFF: 3
# driver_HEND: 0
# driver_HSTRT: 5

[heater_bed]
heater_pin: PB10
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PC4
#control: watermark
min_temp: 0
max_temp: 115

[filament_switch_sensor filament_sensor]
pause_on_runout: false
switch_pin: !PC15
runout_gcode: _ON_FILAMENT_RUNOUT

[output_pin LED]
pin:PB0
pwm: True
cycle_time: 0.010
value: 1

[adxl345]
cs_pin: nozzle_mcu:PA4
spi_speed: 5000000
axes_map: x,-z,y
spi_software_sclk_pin: nozzle_mcu:PA5
spi_software_mosi_pin: nozzle_mcu:PA7
spi_software_miso_pin: nozzle_mcu:PA6

[resonance_tester]
accel_chip: adxl345
accel_per_hz: 75
# min_freq: 30
# max_freq: 100
probe_points:
   110,110,10

[printer]
kinematics: corexy
max_velocity: 600
max_accel: 20000
max_z_velocity: 10
square_corner_velocity: 5.0
# square_corner_max_velocity: 200.0
# max_accel_to_decel: 20000
max_z_accel: 300
[probe_eddy_current btt_eddy]

[exclude_object]

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [probe_eddy_current btt_eddy]
#*# reg_drive_current = 16
#*# calibrate =
#*# 	0.050000:3320148.900,0.089844:3318284.154,0.129687:3316323.107,
#*# 	0.170312:3314422.932,0.210156:3312585.652,0.250000:3310757.655,
#*# 	0.289844:3308977.372,0.329687:3307171.972,0.370312:3305374.643,
#*# 	0.410156:3303625.088,0.450000:3301877.552,0.489844:3300197.981,
#*# 	0.529687:3298474.538,0.570312:3296782.158,0.610156:3295126.290,
#*# 	0.650000:3293508.278,0.689844:3291908.019,0.729687:3290257.188,
#*# 	0.770312:3288640.879,0.810156:3287101.153,0.850000:3285592.090,
#*# 	0.889844:3284073.477,0.929687:3282497.506,0.970312:3281028.108,
#*# 	1.010156:3279630.261,1.050000:3278179.863,1.089844:3276796.199,
#*# 	1.129687:3275415.328,1.170312:3274056.699,1.210156:3272711.170,
#*# 	1.250000:3271423.478,1.289844:3270163.116,1.329687:3268896.511,
#*# 	1.370312:3267593.181,1.410156:3266406.368,1.450000:3265201.653,
#*# 	1.489844:3264038.138,1.529687:3262884.110,1.570312:3261723.772,
#*# 	1.610156:3260608.928,1.650000:3259559.845,1.689844:3258461.861,
#*# 	1.729687:3257432.824,1.770312:3256403.137,1.810156:3255413.847,
#*# 	1.850000:3254424.157,1.889844:3253471.152,1.929687:3252537.789,
#*# 	1.970312:3251579.030,2.010156:3250743.123,2.050000:3249824.091,
#*# 	2.089844:3248985.738,2.129687:3248145.715,2.170312:3247275.673,
#*# 	2.210156:3246444.368,2.250000:3245674.089,2.289844:3244865.597,
#*# 	2.329687:3244106.568,2.370312:3243330.485,2.410156:3242612.597,
#*# 	2.450000:3241926.221,2.489844:3241192.237,2.529687:3240509.046,
#*# 	2.570312:3239783.739,2.610156:3239162.795,2.650000:3238493.427,
#*# 	2.689844:3237837.796,2.729687:3237205.043,2.770312:3236582.181,
#*# 	2.810156:3235956.384,2.850000:3235395.426,2.889844:3234782.272,
#*# 	2.929687:3234198.328,2.970312:3233641.012,3.010156:3233049.212,
#*# 	3.050000:3232520.063,3.089844:3232003.750,3.129687:3231467.596,
#*# 	3.170312:3230961.531,3.210156:3230467.175,3.250000:3229965.271,
#*# 	3.289844:3229489.172,3.329687:3229035.435,3.370312:3228515.485,
#*# 	3.410156:3228082.495,3.450000:3227635.236,3.489844:3227209.861,
#*# 	3.529687:3226755.779,3.570312:3226350.058,3.610156:3225925.172,
#*# 	3.650000:3225528.876,3.689844:3225122.027,3.729687:3224727.758,
#*# 	3.770312:3224339.999,3.810156:3223964.910,3.850000:3223607.864,
#*# 	3.889844:3223250.377,3.929687:3222880.597,3.970312:3222506.111,
#*# 	4.010156:3222157.985,4.050000:3221828.787
#*#
#*# [temperature_probe btt_eddy]
#*# calibration_temp = 29.648944
#*# drift_calibration =
#*# 	3342102.840820, -1012.621701, 6.434798
#*# 	3311996.064691, -651.756776, 3.904706
#*# 	3284956.390710, -325.337827, 1.718862
#*# 	3265594.595165, -169.308209, 0.788685
#*# 	3250577.971760, -62.442558, 0.166595
#*# 	3239348.966104, 1.651444, -0.186502
#*# 	3230637.905304, 50.896342, -0.483228
#*# 	3224065.618281, 77.372384, -0.610073
#*# 	3218711.503330, 102.261143, -0.746162
#*# drift_calibration_min_temp = 32.6070838634831
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 68.306
#*# pid_ki = 1.455
#*# pid_kd = 801.746
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  1.187441, 1.163712, 1.144037, 1.125023, 1.113067, 1.098632, 1.089918, 1.080999, 1.073687, 1.069256, 1.063340, 1.063732, 1.061451, 1.061345, 1.069360, 1.080148, 1.092078, 1.120833, 1.154548, 1.194608
#*# 	  1.177621, 1.149564, 1.130226, 1.117369, 1.101695, 1.092767, 1.083299, 1.077393, 1.077441, 1.068869, 1.071214, 1.076475, 1.080565, 1.086270, 1.096059, 1.112000, 1.130249, 1.150025, 1.170736, 1.183148
#*# 	  1.152302, 1.126728, 1.113787, 1.098528, 1.083355, 1.070248, 1.057761, 1.049059, 1.048170, 1.042270, 1.038696, 1.037768, 1.038506, 1.035735, 1.041171, 1.050786, 1.062854, 1.092470, 1.125449, 1.160503
#*# 	  1.159528, 1.135524, 1.118664, 1.104823, 1.091330, 1.079586, 1.074258, 1.068969, 1.066291, 1.065116, 1.066155, 1.069129, 1.073650, 1.077228, 1.088110, 1.098991, 1.120012, 1.143684, 1.167301, 1.167838
#*# 	  1.137099, 1.117626, 1.105637, 1.091675, 1.078538, 1.067554, 1.057739, 1.051704, 1.046261, 1.043581, 1.037735, 1.037034, 1.033962, 1.034354, 1.041642, 1.054194, 1.069511, 1.107621, 1.154735, 1.210702
#*# 	  1.215765, 1.202860, 1.200101, 1.188925, 1.184905, 1.176769, 1.170400, 1.169753, 1.166327, 1.163877, 1.161134, 1.167079, 1.171304, 1.175323, 1.187373, 1.206776, 1.229176, 1.256161, 1.278983, 1.242167
#*# 	  1.185621, 1.172194, 1.150790, 1.136609, 1.123309, 1.112772, 1.104335, 1.094396, 1.093207, 1.086519, 1.081717, 1.080425, 1.082905, 1.090584, 1.104516, 1.124936, 1.156439, 1.217711, 1.306675, 1.444808
#*# 	  1.468282, 1.444535, 1.474391, 1.489432, 1.491445, 1.488291, 1.485877, 1.485134, 1.482778, 1.479811, 1.479624, 1.485467, 1.496093, 1.504719, 1.520496, 1.538648, 1.561343, 1.590203, 1.616003, 1.612133
#*# 	  1.456172, 1.440949, 1.425123, 1.413782, 1.402431, 1.392318, 1.382941, 1.379484, 1.374753, 1.372886, 1.370792, 1.377072, 1.389174, 1.416287, 1.443593, 1.468196, 1.498443, 1.534950, 1.579515, 1.617559
#*# 	  1.514419, 1.492529, 1.477642, 1.470475, 1.465493, 1.461424, 1.458658, 1.454967, 1.455429, 1.453577, 1.455143, 1.463628, 1.472502, 1.485059, 1.505112, 1.522750, 1.546069, 1.578047, 1.604844, 1.602503
#*# 	  1.503625, 1.491436, 1.477472, 1.466386, 1.457157, 1.448295, 1.439619, 1.433474, 1.430675, 1.430326, 1.428747, 1.433030, 1.438523, 1.445224, 1.455751, 1.472204, 1.494930, 1.526459, 1.566147, 1.593690
#*# 	  1.477271, 1.450912, 1.441692, 1.432431, 1.425406, 1.423290, 1.421350, 1.419824, 1.422028, 1.421235, 1.421277, 1.431396, 1.441305, 1.455169, 1.473495, 1.495742, 1.520354, 1.550654, 1.580414, 1.586565
#*# 	  1.474751, 1.463823, 1.457162, 1.450039, 1.442083, 1.433267, 1.427922, 1.425718, 1.425541, 1.425453, 1.426738, 1.431775, 1.434454, 1.444002, 1.456868, 1.472264, 1.494019, 1.527804, 1.570221, 1.600268
#*# 	  1.435394, 1.423263, 1.422645, 1.418434, 1.413049, 1.411283, 1.411548, 1.415875, 1.421369, 1.422076, 1.430194, 1.438498, 1.449782, 1.464622, 1.484848, 1.505871, 1.532865, 1.563422, 1.596093, 1.611564
#*# 	  1.395303, 1.400957, 1.403695, 1.397777, 1.397232, 1.392991, 1.394671, 1.395908, 1.401297, 1.405337, 1.409136, 1.414173, 1.423539, 1.432523, 1.450285, 1.465223, 1.491569, 1.531722, 1.573001, 1.598889
#*# 	  1.330119, 1.325798, 1.332602, 1.334808, 1.336832, 1.338228, 1.343651, 1.353101, 1.361980, 1.369848, 1.378957, 1.396682, 1.410095, 1.427162, 1.448012, 1.473948, 1.510462, 1.545607, 1.574666, 1.585356
#*# 	  1.277724, 1.291107, 1.297746, 1.303165, 1.307251, 1.310702, 1.317232, 1.324862, 1.332304, 1.344395, 1.357510, 1.366760, 1.378602, 1.395106, 1.411921, 1.434528, 1.463739, 1.503278, 1.550064, 1.583711
#*# 	  1.217110, 1.217383, 1.231824, 1.244719, 1.262955, 1.273991, 1.292516, 1.307819, 1.324769, 1.340774, 1.355763, 1.373904, 1.397194, 1.418974, 1.444194, 1.474320, 1.506219, 1.547432, 1.585426, 1.603566
#*# 	  1.155313, 1.167383, 1.186785, 1.205592, 1.224305, 1.240774, 1.260742, 1.281140, 1.299162, 1.317287, 1.335178, 1.349082, 1.370904, 1.388967, 1.412829, 1.434489, 1.468750, 1.514357, 1.566831, 1.607208
#*# 	  1.062009, 1.069841, 1.091290, 1.119394, 1.138281, 1.183114, 1.213953, 1.244796, 1.271496, 1.298170, 1.321854, 1.349518, 1.372636, 1.404138, 1.432300, 1.463398, 1.496524, 1.553804, 1.594611, 1.612459
#*# x_count = 20
#*# y_count = 20
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 10.0
#*# max_x = 204.94
#*# min_y = 10.0
#*# max_y = 209.88000000000005
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 29.122
#*# pid_ki = 3.595
#*# pid_kd = 58.971
